<!DOCTYPE html>
<html>
<head>
  <title>Firebase Connection Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
    .success { color: #00ff00; }
    .error { color: #ff0000; }
    .info { color: #00aaff; }
    pre { background: #000; padding: 10px; border: 1px solid #333; }
  </style>
</head>
<body>
  <h1>üî• Firebase Connection Test</h1>
  <div id="output"></div>

  <script type="module">
    const output = document.getElementById('output');
    
    function log(msg, type = 'info') {
      const div = document.createElement('div');
      div.className = type;
      div.textContent = msg;
      output.appendChild(div);
    }

    async function testFirebase() {
      try {
        log('üîß Importing Firebase modules...', 'info');
        
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
        const { getAuth, signInAnonymously } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
        const { getFirestore, collection, addDoc, getDocs, doc, setDoc, deleteDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

        const firebaseConfig = {
          apiKey: "AIzaSyDi9DX1nEPBXTHuQEuzcpc-BSYVj7DxgPA",
          authDomain: "dndmeetsdcc.firebaseapp.com",
          projectId: "dndmeetsdcc",
          storageBucket: "dndmeetsdcc.firebasestorage.app",
          messagingSenderId: "425884882250",
          appId: "1:425884882250:web:bc666f87585802ef7b5db3"
        };

        log('‚úÖ Firebase modules loaded', 'success');
        log('üöÄ Initializing Firebase...', 'info');
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        log('‚úÖ Firebase initialized', 'success');
        log('üîê Signing in anonymously...', 'info');

        const userCredential = await signInAnonymously(auth);
        log(`‚úÖ Signed in (UID: ${userCredential.user.uid})`, 'success');

        // Test each collection type
        const collections = ['crawlers', 'mobs', 'maps', 'episodes', 'inventory'];
        
        for (const collectionName of collections) {
          log(`\nüìÇ Testing ${collectionName} collection...`, 'info');
          
          const testId = `test-${collectionName}-${Date.now()}`;
          const testData = {
            id: testId,
            name: `Test ${collectionName}`,
            testField: 'test value',
            number: 42,
            array: [1, 2, 3],
            nested: { key: 'value' }
          };

          try {
            // CREATE
            const docRef = doc(db, collectionName, testId);
            await setDoc(docRef, testData);
            log(`  ‚úÖ Created document in ${collectionName}`, 'success');

            // READ
            const snapshot = await getDocs(collection(db, collectionName));
            const found = snapshot.docs.find(d => d.id === testId);
            if (found) {
              log(`  ‚úÖ Read document from ${collectionName} (${snapshot.docs.length} total docs)`, 'success');
            } else {
              log(`  ‚ùå Could not read created document`, 'error');
            }

            // DELETE
            await deleteDoc(docRef);
            log(`  ‚úÖ Deleted test document from ${collectionName}`, 'success');

          } catch (error) {
            log(`  ‚ùå Error with ${collectionName}: ${error.message}`, 'error');
            console.error(error);
          }
        }

        log('\nüéâ All Firebase tests completed!', 'success');
        log('\nüìä Firebase is properly connected and all collection types are working.', 'success');

      } catch (error) {
        log(`‚ùå Fatal error: ${error.message}`, 'error');
        console.error(error);
      }
    }

    testFirebase();
  </script>
</body>
</html>
